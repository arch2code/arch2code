# AI Agent Rules

You are an expert Hardware Architect using Arch2Code YAML architecture, SystemC modeling, and SystemVerilog RTL implementation.

Use this file as the top-level router. Keep detailed implementation guidance in skill files under `.cursor/rules/` (or `.ai/skills/`).

## Project Layout (Minimal)
```text
repo_root/
├── arch/         # Architecture YAML
├── model/        # SystemC model code
├── rtl/          # SystemVerilog RTL code
├── tb/           # Testbench code
├── rundir/       # Main run/build Makefile entry
└── builder/      # Arch2Code toolchain and templates
```

## Skill Routing
Route requests to the most relevant primary skill, then bring in secondary skills only as needed.

| User Intent | Primary Skill File |
| :--- | :--- |
| **Start/Config** | `setup-project.md` (Project init, `project.yaml`) |
| **Address/Mem** | `manage-address-space.md` (Address map, decoding, FW headers) |
| **Architecture** | `design-architecture.md` (YAML blocks, interfaces) |
| **Build/Run** | `manage-build.md` (`make` targets, `gen`, `db`) |
| **SystemC Core** | `systemc-core.md` (Modules, threads, logging) |
| **SystemC Sync** | `systemc-synchronization.md` (Locking, arbitration, events) |
| **SystemC Data** | `systemc-resources.md` (Registers, memories, trackers) |
| **SystemC Ports** | `systemc-interfaces.md` (AXI, Rdy/Vld, Push/Ack) |
| **SystemC Patterns** | `systemc-patterns.md` (Producer-Consumer, Register Handler, Multi-Cycle) |
| **RTL Core** | `rtl-core.md` (Modules, FSMs, resets) |
| **RTL Regs** | `rtl-registers.md` (Decoder architecture, external regs) |
| **RTL Arbiter** | `rtl-arbitration.md` (`memArb`, `vldAckArb`) |
| **RTL Datapath** | `rtl-datapath.md` (FIFOs, `inPlaceList`, Capture) |
| **RTL Ports** | `rtl-interfaces.md` (Interface usage) |
| **RTL Patterns** | `rtl-patterns.md` (Streaming, Req-Resp, Arbitration) |
| **Verification** | `verify-testbench.md` (Testbenches, scoreboards) |
| **Co-Sim** | `verify-cosimulation.md` (Verilator wrappers, Tandem) |
| **Tandem** | `run-tandem.md` (Build/run tandem verification for leaf blocks) |

## Global Constraints
1. **Conventions First:** Follow local style and existing project patterns.
2. **Make-Driven Flow:** Always use project `make` targets over ad-hoc script invocation.
3. **Generated Code Safety:** **NEVER** modify code between `// GENERATED_CODE_BEGIN` and `// GENERATED_CODE_END` markers.
4. **Verification Default:** After YAML changes, run `make gen`; run `make run` when behavior is affected.

## Routing Defaults
- **New module path:** `setup-project` -> `design-architecture` -> `manage-build` -> `systemc-core` / `rtl-core`
- **Feature path:** `design-architecture` (if interface changes) -> relevant `systemc-*` / `rtl-*` skills
- **Debug path:** `verify-testbench` -> `manage-build` -> `run-tandem`

## Maintenance
Source-of-truth templates and skills are managed in `builder/base`. Regenerate local files with `make cursor-clean && make cursor-setup`.
